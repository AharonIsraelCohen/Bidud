#!/bin/bash

SpoolPath=/software/Bidud/Printer/spool

Printer=default

# Getting the first chracter
FirstCharacter=`echo $1 | cut -c 1`

function PrintLine ()
{
	# Check whter the line is clearןכ 
	echo $Printer
	if [ -f $SpoolPath/$Printer/enable ] 
		then
			
		# Check if there are no files
		if [ -z $1 ] 
			then
				text=""
				echo please enter your text
				read text
				Line $text

		# IF there are files
		else 
			for file in $@
				do
					# Check if the files exist
					if [ -f $file ]
					then
						Line $(cat $file)
					else
						echo The $file dont exist
					fi
				done
		fi

	else
	       echo The printer line is disbled 	
	fi
}

function Line ()
{
	echo $@
	currCount=$(( $(cat $SpoolPath/$Printer/count) + 1 ))
        touch $SpoolPath/$Printer/R$currCount
        echo $@ > $SpoolPath/$Printer/R$currCount
        echo $currCount > $SpoolPath/$Printer/count
}


# Checking what printer to activate
if [ $FirstCharacter == "-" ]

	then
		# Getting the printer name
		printerName=`echo $1 | sed 's/^.//'`

		if [ -d $SpoolPath/$printerName ]
			then	
				# Declearing the printer and Taking off the printer name from the input
				Printer=$printerName
				Input=`echo $@ | sed 's/[^ ]* *//'`
				PrintLine $Input

			else
				echo the printer not exsit
		fi

	else
		# Checking if there is a default printer
		if [ -e $SpoolPath/default ]
			then
				PrintLine $@
			else
				pwd
				echo there is no default printer, use lpadmin -default printer_name to set one
		fi
fi
